<!DOCTYPE html>
<html>
<head>
    <title>iRave Grupo 16</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/kube.css" />
    <link rel="stylesheet" type="text/css" href="slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="slick/slick-theme.css"/>
    <link rel="stylesheet" type="text/css" href="css/ipm.css"/>
    <link rel="stylesheet" href="powerange-master/dist/powerange.css" />
    <link rel="stylesheet" href="css/flipclock.css" />
    

</head>
<body>
    <div class="topbox" style="width:130px;position:relative;">
        <button class="btn btn-black" id="button-main" style="display: inline-block; width: 20px; left: 0px;top:50px; position: absolute; padding: 0px;height:25px;margin:0px"><i class="fa fa-bars"></i></button>
        <button class="btn btn-black" id="button-back" style="display: inline-block; width: 20px; right: 0px;top:50px; position: absolute; padding: 0px;height:25px;margin:0px"><i class="fa fa-undo"></i></button>
    </div>
    <div style="margin:auto;" class="screen">
        <div id="main-container">
            <div class="menu-fit color-change" id="nav-menu">
                <div class="units-row units-split" style="overflow:auto">
                    <div class="text-centered cursor-ptr btn-help" style="background-color:rgba(0, 0, 0, 0.2);color:black;border-radius:10px;margin:10px">
                        <span style="position:relative;top:5px"><i class="fa fa-question fa-2x" style="color:white;display:inline-block"><h2 style="color:white;font-size:80%;display:inline-block"> &nbsp Ajuda</h2></i></span>
                    </div>
                </div>
                <div id="menu-icons" class="units-row units-split" style="margin-top:-45px" >
                    <div class="slick-menu big">
                 
                    </div>
                </div>
                <div class="units-row units-split" style="margin-top:-35px">
                    <div class="slick-menu-text">
            
                    </div>
                </div>
            </div>
            <div id="replace-screen" class="noselect">
            </div>
        </div>
    </div>
    
    <div class="topbox" style="width:130px;position:relative;margin-top:-75px">

        <button class="btn btn-black" id="button-home" style="display: inline-block; width: 20px; left: 0px;top:0px; position: absolute; padding: 0px;height:25px;margin:0px"><i class="fa fa-home"></i></button>
        <button class="btn btn-black" id="button-lock" style="display: inline-block; width: 20px; right: 0px;top:0px; position: absolute; padding: 0px;height:25px;margin:0px"><i class="fa fa-lock"></i></button>
    </div>
    
    <div id="simulador" class="topbox noselect" style="width:300px">
        <div style="margin-top:100px;background-color:rgba(54, 54, 54, 0.8);padding:10px">
            <span class="text-centered"><h4 style="color:white;font-size:100%">Simulador de passos </h4></span>

            <form method="post" style="color:white;font-size:50%">
            <span style="width:100px;padding-left:20px;display:inline">
                <label> X
                    <input style="width:110px;"type="number" step="5" id="form-x">
                </label>
            </span>
            <span style="width:100px;display:inline">
                <label> Y
                        <input style="width:110px;"type="number" step="5" id="form-y">
                </label>
            </span>
            </form>

           <button class="btn btn-green" id="button-teleport" style="font-size:100%;color:white;padding:0px;width:100%;padding:5px;height:100%">
               <div >Ir para 1º destino!</div>
            </button>
        </div>
    </div>

    <script src="js/jquery.js"></script>
    <script src="js/kube.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/dragdealer.js"></script>
    <script src="js/flipclock.min.js"></script>
    <script src="js/jquery.animate-colors.js"></script>
    <script type="text/javascript" src="slick/slick.js"></script>
    <script src="powerange-master/dist/powerange.min.js"></script> 
    <script src="js/draggabilly.pkgd.min.js"></script>
    <script>
        var lockMenu = true;
        var lock = false;
        var currentMain = 0;
        var currentPic = 0;
        var offset = getPPI()*1.28*2.36;
        var activated = false;  
        var backtracker = [];
        var currentBackground;
        var currentPage;
        var currentSelectionLine;
        var maxId = 5;
        
        var somModoManual = 0;
        var somModoConstante = 50;
        var somActiveMode = 0;
        var positionXY = [0.5,0.5];
        var helpPressed = false;

        var unlock_drag;
        
        var whatWasClicked = "";
        
        var inHomeScreen = true;
        var equalizer = {
            eq1: 0,
            eq2: 30,
            eq3: 60
        };
        
        var volumeSliders = {
            s1: 0,
            s2: 30,
            s3: 60,
            s4: 80
        };
        
        var slideIndex = 0;

        var gallery = {
            day: [{
                date: "25/06",
                photos: [{
                    image:"pic1c.jpg",
                    id:1
                },{
                    image: "pic2c.jpg",
                    id:2
                }]
            },{
                date: "26/06",
                photos: [{
                    image:"pic3c.jpg",
                    id:3
                },{
                    image: "pic4c.jpg",
                    id:4
                }] 
            } 
            ]
        };

        var user = {
            x: 50,
            y: 50
        }

        var navigation = {
            in_navigation: false,
            tent: {
                set: false
            },
            selected_location: 0,
            destinations: [],
            locations : [
            {              
                id: 1,
                x: 510,
                y: 320,
                image: "food.png",
                favorite: false,
                name: "Restaurantes",
                desc: "'Se precisar de um snack...'"
            },
            {
                id: 2,
                x: 410,
                y: 480,
                image: "music.png",
                favorite: false,
                name: "Palco Principal",
                desc: "'A tocar no palco: Excision!'"
            },
            {
                id: 4,
                x: 620,
                y: 460,
                image: "atm.png",
                favorite: false,
                name: "Multibanco",
                desc: "'Não se esqueça de gastar responsavelmente!'"
            },
            {
                id: 5,
                x: 30,
                y: 200,
                image: "atm.png",
                favorite: false,
                name: "Multibanco",
                desc: "Será que precisa de levantar dinheiro?"
            },
            {
                id: 6,
                x: 360,
                y: 100,
                image: "ouch.png",
                favorite: false,
                name: "Posto Médico",
                desc: "'Caso o festival esteja a ser complicado...'"
            },
            {
                id: 7,
                x: 60,
                y: 430,
                image: "shopping-cart.png",
                favorite: false,
                name: "Merchandise",
                desc: "'Mostre aos seus amigos que veio ao festival!'"
            },
            {
                id: 8,
                x: 650,
                y: 570,
                image: "info.png",
                favorite: false,
                name: "Informação",
                desc: "'Sente-se perdido? Peça ajuda!'"
            },
            {
                id: 9,
                x: 240,
                y: 280,
                image: "beer.png",
                favorite: false,
                name: "Bebidas",
                desc: "'Não se esqueça! Se beber não conduza...'"
            }]
        };
        
        function updateTime() {
            var today=new Date();
            var h=today.getHours();
            var m=today.getMinutes();
            var s=today.getSeconds();
            m = checkTime(m);
            s = checkTime(s);
            $(".watch").html(h+":"+m);
        }
        function startTime() {
            var today=new Date();
            var h=today.getHours();
            var m=today.getMinutes();
            var s=today.getSeconds();
            m = checkTime(m);
            s = checkTime(s);
            $(".watch").html(h+":"+m);
            var t = setTimeout(function(){startTime()},500);
        }

        function checkTime(i) {
            if (i<10) {i = "0" + i};  // add zero in front of numbers < 10
            return i;
        }
        function add_destination(dest){
            navigation.destinations.push(dest);
        }
        function get_distance(l1, l2){
            var a = Math.round(Math.abs(Math.sqrt(Math.pow(l1.x-l2.x,2)+Math.pow(l1.y-l2.y,2))));
            return a;
        }

        function create_pic(pic){
            gallery.day[1].photos.push({
                image:pic,
                id:maxId    
            });
            maxId++;
        }
        function delete_pic_by_id(id){
            for(i = 0; i < gallery.day.length; i++){
                for(j = 0; j<gallery.day[i].photos.length; j++){
                    if(gallery.day[i].photos[j].id == id )
                        gallery.day[i].photos.splice(j,1);
                }
            }
        }

        function get_pic_by_id(id){
            for(i = 0; i < gallery.day.length; i++){
                for(j = 0; j<gallery.day[i].photos.length; j++){
                    if(gallery.day[i].photos[j].id == id )
                        return gallery.day[i].photos[j].image;

                }
            }
        }
        function get_day_by_id(id){
            for(i = 0; i < gallery.day.length; i++){
                for(j = 0; j<gallery.day[i].photos.length; j++){
                    if(gallery.day[i].photos[j].id == id )
                        return i;
                }
            }
        }
        function getPPI(){
             // create an empty element
             var div = document.createElement("div");
             // give it an absolute size of one inch
             div.style.width="1in";
             // append it to the body
             var body = document.getElementsByTagName("body")[0];
             body.appendChild(div);
             // read the computed width
             var ppi = document.defaultView.getComputedStyle(div, null).getPropertyValue('width');
             // remove it again
             body.removeChild(div);
             // and return the value
             return parseFloat(ppi);
        }

        function down(){
            $('#main-container').animate({
                'margin-top': 0 + 'px'
            });
        }
        function up(){
            $('#main-container').animate({
                'margin-top': '-' + offset*0.87 + 'px'
            });
        }
        function add_backtracker(page,sucess_function){
            if(backtracker.length > 0){
                var t = backtracker.pop();
                if( currentPage.page != t.page ){
                    backtracker.push(t);
                    backtracker.push(currentPage);
                }else{
                    backtracker.push(t);
                }
            }else{
                backtracker.push(currentPage);
            }
        }
        function add_function_backtracker(success_function){
            backtracker.push({
                page:null,
                load_function:success_function
            });
        }
        function reset_backtracker(){
            backtracker = [];
            backtracker.push({
                page: "cam-main-menu.html",
                load_function: function(){
                    up();
                    activated = !activated;
                }
            });
        }
        function add_menu_backtracker(){
            add_function_backtracker(function(){
                down();
                activated= !activated;
            });
        }
        function load_page(page,track,sucess_function){
            if(track){
                add_backtracker(page,sucess_function);
            }
            currentPage={
                page: page,
                load_function: sucess_function
            };
            $.ajax({
                type: "GET",
                url: page,
                dataType: "html",
                success: function(html){
                        $("#replace-screen").html(html);
                        var a = $(".end-screen").position();
                        $(".end-screen").height(offset);
                        sucess_function();
                },
                        error: function(x1,x2,x3){
                }
            });
        }
 
        function back(){
            if(backtracker.length>0){
                var temp = backtracker.pop();
                if(temp.page == null){
                    temp.load_function();
                }else{
                    if(temp.load_function != null)
                    load_page(temp.page,false,temp.load_function);
                    else
                    load_page(temp.page,false);
                }
            }

        }

        function default_background(){
            currentBackground.pic = "bck/festival3";
            currentBackground.zoom = 0;
        }
        function load_background(bg, zoom,append){
            set_background(bg,zoom);
            reload_background(append);
        }

        function set_background(bg,zoom){
            currentBackground.pic = bg;
            currentBackground.zoom = zoom;
        }

        function reload_background(append){
            var pic = "";
            if(append){
                if(currentBackground.zoom == -1)
                    pic = currentBackground.pic + "-out.jpg";
                else if(currentBackground.zoom == 1)
                    pic = currentBackground.pic + "-in.jpg";
                else
                    pic = currentBackground.pic + "-nrm.jpg";
            }else
                pic = currentBackground.pic;
            $(".background-image").css("backgroundImage","url(image/"+pic+")"); 
        }
        function change_user_position(x,y){
            user.x = x;
            user.y = y;
            $("#form-x").val(user.x);
            $("#form-y").val(user.y);
        }
        function load_map(){
            var content;
            for( i = 0; i < navigation.locations.length; i++){
                content += '<img src="image/'+navigation.locations[i].image+'" class="map-pic cursor-ptr" style="top:'+navigation.locations[i].y+'px;left:'+navigation.locations[i].x+'px" data-nav="'+navigation.locations[i].id+'">'
            }
            content += '<img src="image/user.png" id="user" class="user-map-pic" style="top:'+user.y+'px;left:'+user.x+'px">';
            $("#fill-map").append(content);
            $(".map-pic").click(function(){
                var id = $(this).attr("data-nav");
                navigation.selected_location = id;
                load_page("nav-location.html",true,function(){
                    load_location_page(id);
                });
            });
            new Dragdealer("slider-container",{
                            vertical: true,
                            x:0,
                            y:0,
                            loose:true,
                            speed:0.4
                        });
        }
        
        function redraw_user(){
            $("#user").css("top",user.y+"px");
            $("#user").css("left",user.x+"px");
            if(navigation.in_navigation == true){
                var loc = get_location_by_id(navigation.destinations[0]);
                var a = get_distance(user,loc);
                $("#location-dist").html(a + " m");
                if(a <20 ){
                    navigation.destinations.shift();
                    if(navigation.destinations.length > 0){
                        load_arrow_page();
                    }else{
                        navigation.in_navigation = false;
                        $("#location-dist").html("Chegou ao seu destino!");             
                        $("#btn-nav-cancel").toggle();
                    }
                }
            }
        }

        function get_location_by_id(id){
            for(i = 0; i < navigation.locations.length;i++){
                if(navigation.locations[i].id == id)
                    return navigation.locations[i];
            }
        }

        function load_location_page(id){
            var loc = get_location_by_id(id);
            $("#location-image").attr("src","image/"+loc.image);
            $("#location-name").html(loc.name);
            $("#location-desc").html(loc.desc);
            if(loc.favorite==true){
                $("#fav-icon").toggleClass("fa-star");
                $("#fav-icon").toggleClass("fa-star-o");
            }
        }

        function load_arrow_page(id){
            if(navigation.destinations.length>0){
                var t;
                if(navigation.destinations[0] != null)
                    t = navigation.destinations[0];
                else{
                    navigation.destinations.shift();
                    if(navigation.destinations[0] != null)
                        t = navigation.destinations[0];
                    else{
                        navigation.destinations.shift();
                    }
                }
                    
                var loc = get_location_by_id(navigation.destinations[0]);
                $("#location-name").html(loc.name);
                var a = get_distance(user,loc);
                $("#location-dist").html(a + " m");
            } else {
                 load_page("nav-route-error.html",false,function(){
                     $('#btn-back').click(function(){
                        back(); 
                     });
                 });
            }
        }
        function load_tent_page(){
            if(navigation.tent.set){
                $("#without-tent").toggle();
            } else {
                $("#with-tent").toggle(); 
            }
        }
        function load_locations_page(){
            var content = '';
            for( i = 0; i < navigation.locations.length; i++){
                var a = get_distance(user,navigation.locations[i]);
                content += '<div style="display:table-cell;width:270px;height:270px;" class="horizontal-loc-img"><h2 style="padding-top:10px" class="text-centered">'+navigation.locations[i].name+' - '+a+' m</h2><img class="horizontal-loc-pic" src="image/'+navigation.locations[i].image+'" data-nav="'+navigation.locations[i].id+'"></div>';
            }
            
            $("#horizontal-fill").html(content);
            $(".horizontal-loc-pic").mousedown(function(){
                click = true;
                setTimeout(function(){
                    click = false;
                },120);
            });
            $(".horizontal-loc-pic").mouseup(function(){
                if(click){
                    var id = $(this).attr("data-nav");
                    navigation.selected_location = id;
                    load_page("nav-location.html",true,function(){
                        load_location_page(id);
                    });
                }
            });
            
            new Dragdealer('horizontal-slider-container',{
                steps: navigation.locations.length,
                requestAnimationFrame:true,
                loose:true
            });
            
        }
        function load_selection_page(show_favorites){
            var content = '';
            var count = 0;
            for( i = 0; i < navigation.locations.length; i++){
                if((navigation.locations[i].favorite == true && show_favorites == true )|| show_favorites==false){
                    count++;
                var a = get_distance(user,navigation.locations[i]);
                content += '<div style="display:table-cell;width:270px;height:270px;" class="horizontal-sel-img"><h2 style="padding-top:10px" class="text-centered">'+navigation.locations[i].name+' - '+a+' m</h2><img class="horizontal-sel-pic" src="image/'+navigation.locations[i].image+'" data-nav="'+navigation.locations[i].id+'"></div>';
                }
            }
            if(count == 0){
                $("#horizontal-fill").html('<h1 style="padding-top:20px;padding-left:10px; padding-right:10px" class="text-centered">Adiciona favoritos para os encontrares aqui!</h1>');
            }else{
                $("#horizontal-fill").html(content);
                $(".horizontal-sel-pic").mousedown(function(){
                    click = true;
                    setTimeout(function(){
                        click = false;
                    },120);
                });
                $(".horizontal-sel-pic").mouseup(function(){
                    if(click){
                        var id = $(this).attr("data-nav");
                        navigation.destinations[currentSelectionLine] = id;
                        load_page("nav-route.html",true,function(){
                            load_route_page();
                        });
                    };
                });

                new Dragdealer('horizontal-slider-container',{
                    steps: navigation.locations.length,
                    requestAnimationFrame:true,
                    loose:true
                });
            }
            if(show_favorites)
                $("#nav-replace-text").html('&nbsp <i class="fa fa-star"></i> Favoritos');
            
        }
        
        function load_favorites_page(){
            var content = '';
            var count = 0;
            for( i = 0; i < navigation.locations.length; i++){
                if(navigation.locations[i].favorite == true){
                    count++;
                    var a = get_distance(user,navigation.locations[i]);
                content += '<div style="display:table-cell;width:270px;height:270px;" class="horizontal-loc-img"><h2 style="padding-top:10px" class="text-centered">'+navigation.locations[i].name+' - '+a+' m</h2><img class="horizontal-loc-pic" src="image/'+navigation.locations[i].image+'" data-nav="'+navigation.locations[i].id+'"></div>';
                }
            }
            if(count == 0){
                $("#horizontal-fill").html('<h1 style="padding-top:20px;padding-left:10px; padding-right:10px" class="text-centered">Adiciona favoritos para os encontrares aqui!</h1>');
            }else{
                $("#horizontal-fill").html(content);
                $(".horizontal-loc-pic").mousedown(function(){
                    click = true;
                    setTimeout(function(){
                        click = false;
                    },120);
                });
                $(".horizontal-loc-pic").mouseup(function(){
                    if(click){
                        var id = $(this).attr("data-nav");
                        navigation.selected_location = id;
                        load_page("nav-location.html",true,function(){
                            load_location_page(id);
                        });
                    }
                });


                new Dragdealer('horizontal-slider-container',{
                    steps: count,
                    requestAnimationFrame:true,
                    loose:true
                });
                $("#nav-replace-text").html('&nbsp <i class="fa fa-star"></i> Favoritos');
            }
        }        
        
        function load_route_page(){
            $("#text-route-1").html("______");
            $("#text-route-2").html("______");
            $("#text-route-3").html("______");
            if(navigation.destinations.length > 0){
                if(navigation.destinations[0] != null){
                    $("#text-route-1").html(get_location_by_id(navigation.destinations[0]).name);
                }
                if(navigation.destinations[1] != null){
                    $("#text-route-2").html(get_location_by_id(navigation.destinations[1]).name);
                }
                if(navigation.destinations[2] != null){
                    $("#text-route-3").html(get_location_by_id(navigation.destinations[2]).name);
                }
            }
        }
        
        function load_gallery(){
            var content;
            content_h= '';
            content_v = '';
            for (i = 0; i < gallery.day.length; i++) {
                if(gallery.day[i].photos.length > 0 ){
                        content_h += '<div style="position:relative;display:table-cell" class="horizontal-img"><h2 style="padding-top:10px;padding-bottom:10px;position:absolute;left:60px;top:10px;z-index:3;background:rgba(255, 255, 255, 0.6);border-radius:10px;border: 2px solid rgba(0, 0, 0, 0.6);width:50%;margin-top:5px" class="text-centered">'+gallery.day[i].date+'</h2><img class="horizontal-pic" src="image/'+gallery.day[i].photos[0].image+'" data-img="'+gallery.day[i].photos[0].id+'"></div>';
                    }
            }
            
            $("#horizontal-fill").html(content_h);
            $("#vertical-fill").html(content_v);
            $("#vertical-slider-container").toggle();
            var sum=0;
            $('.horizontal-img').each( function(){ sum += $(this).width(); });
            $('#horizontal-handle').width( sum );
            new Dragdealer('horizontal-slider-container',{
                steps: gallery.day.length,
                requestAnimationFrame:true,
                loose:true
            });
            $(".horizontal-pic").mousedown(function(){
                click=true;
                setTimeout(function(){
                    click=false;
                },150);
            });
            $(".horizontal-pic").mouseup(function(){
                if(click){
                    var id = $(this).attr("data-img");
                    var d = get_day_by_id(id);
                    
                    add_backtracker("cam-gallery.html",function(){
                        $("#vertical-slider-container").toggle();
                        $("#horizontal-slider-container").toggle();
                        $("#gallery-replace-text").html('&nbsp <i class="fa fa-picture-o"></i> Galeria');
                    });

                    for(i = 0; i < gallery.day[d].photos.length; i++){
                        content_v +='';
                        content_v +='<div><img src="image/'+ gallery.day[d].photos[i].image +' " class="vertical-pic" data-img="'+gallery.day[d].photos[i].id+'"></div>';
                    }
                    $("#vertical-handle").html(content_v);
                    $("#horizontal-slider-container").toggle();
                    $("#vertical-slider-container").toggle();
                    $("#gallery-replace-text").html('&nbsp <i class="fa fa-picture-o"></i> Galeria&nbsp&nbsp&nbsp&nbsp'+gallery.day[d].date);
                    new Dragdealer('vertical-slider-container',{
                        horizontal:false,
                        vertical:true,
                        loose: true,
                        steps: gallery.day[d].photos.length
                    });

                    $(".vertical-pic").mousedown(function(){
                        click=true;
                        setTimeout(function(){
                            click=false;
                        },150);
                    });
                    $(".vertical-pic").mouseup(function(){
                        if(click){
                            currentPic = $(this).attr("data-img");
                            load_background(get_pic_by_id(currentPic,0),false);
                            load_page("cam-after-gallery.html",true,function(){
                                reload_background(false);
                            });
                        }
                    });
                }
            });
        }

        function bind_menu_buttons(){
            $(".btn-som-help").click(function() { <!-- FIX -->
                if(!lock){
                    load_page("som-help.html",true, function(){
                    });
                    up();
                    activated = !activated;
                    reset_backtracker();
                    add_menu_backtracker();

                }
                return false;
                
            });
            $(".btn-nav-help").click(function() { <!-- FIX -->
                if(!lock){
                    load_page("nav-help.html",true, function(){
                    });
                    up();
                    activated = !activated;
                    reset_backtracker();
                    add_menu_backtracker();

                }
                return false;
                
            });
            $(".btn-cam-help").click(function() { <!-- FIX -->
                if(!lock){
                    load_page("cam-help.html",true, function(){
                    });
                    up();
                    activated = !activated;
                    reset_backtracker();
                    add_menu_backtracker();

                }
                return false;
                
            });
            
            $("#btn-modos").click(function() { <!-- FIX -->
                if(!lock){
                    load_page("som-modos.html",true, function(){
                        $('#modos-text').slick('slickGoTo', somActiveMode,true); 
                        $("#choices").slick('slickGoTo', somActiveMode, true); 
                    });
                    up();
                    activated = !activated;
                    reset_backtracker();
                    add_menu_backtracker();

                }
                return false;
                
            });
            
            $("#btn-equalizador").click(function() { <!-- FIX -->
                if(!lock){
                    load_page("som-equalizador.html",true,function(){
                        var elemEqualizador1 = document.querySelector('.js-equalizador1');
                        var initEqualizador1 = new Powerange(elemEqualizador1, {hideRange: true, callback: funcEq1, vertical: true, klass: 'power-ranger', start: equalizer.eq1 });
                        var elemEqualizador2 = document.querySelector('.js-equalizador2');
                        var initEqualizador2 = new Powerange(elemEqualizador2, {hideRange: true, callback: funcEq2, vertical: true, klass: 'power-ranger', start: equalizer.eq2 });
                        var elemEqualizador3 = document.querySelector('.js-equalizador3');
                        var initEqualizador3 = new Powerange(elemEqualizador3, {hideRange: true, callback: funcEq3, vertical: true, klass: 'power-ranger', start: equalizer.eq3 });
                        
                        function funcEq1(){
                            equalizer.eq1 = elemEqualizador1.value;
                        };
                        function funcEq2(){
                            equalizer.eq2 = elemEqualizador2.value;
                        };
                        function funcEq3(){
                            equalizer.eq3 = elemEqualizador3.value;
                        };
                        
                    });
                    up();
                    activated = !activated;
                    reset_backtracker();
                    add_menu_backtracker();

                }
                return false;
                
            });
            
            $("#btn-volume").click(function() { <!-- FIX -->
                if(!lock){
                    load_page("som-volume.html",true,function(){
                        var elemVol1 = document.querySelector('.js-vol1');
                        var initVol1 = new Powerange(elemVol1, {hideRange: true, callback: funcS1, klass: 'power-ranger', start: volumeSliders.s1 });
                        var elemVol2 = document.querySelector('.js-vol2');
                        var initVol2 = new Powerange(elemVol2, {hideRange: true, callback: funcS2, klass: 'power-ranger', start: volumeSliders.s2 });
                        var elemVol3 = document.querySelector('.js-vol3');
                        var initVol3 = new Powerange(elemVol3, {hideRange: true, callback: funcS3, klass: 'power-ranger', start: volumeSliders.s3 });
                        var elemVol4 = document.querySelector('.js-vol4');
                        var initVol4 = new Powerange(elemVol4, {hideRange: true, callback: funcS4, klass: 'power-ranger', start: volumeSliders.s4 });


                        function funcS1(){
                            volumeSliders.s1 = elemVol1.value;
                        };
                        function funcS2(){
                            volumeSliders.s2 = elemVol2.value;
                        };
                        function funcS3(){
                            volumeSliders.s3 = elemVol3.value;
                        };
                        function funcS4(){ 
                            volumeSliders.s4 = elemVol4.value;
                        };

                        new Dragdealer('sliders-volume',{
                            horizontal:false,
                            vertical:true,
                            y:0.5
                        });

                    });
                    up();
                    activated = !activated;
                    reset_backtracker();
                    add_menu_backtracker();
                }
                return false;

            });
            $("#btn-tent").click(function(){
                load_page("nav-tent.html",true,function(){
                    load_tent_page();
                });
                up();
                activated = !activated;
                reset_backtracker();
                add_menu_backtracker();
            });
            $("#btn-route").click(function(){
                load_page("nav-route.html",true,function(){
                    load_route_page();
                });
                up();
                activated = !activated;
                reset_backtracker();
                add_menu_backtracker();
            });
            $("#btn-loc").click(function(){
                load_page("nav-locations.html",true,function(){
                    load_locations_page();
                });
                up();
                reset_backtracker();
                    add_menu_backtracker();
                activated = !activated;
            });
            $("#btn-fav").click(function(){
                load_page("nav-locations.html",true,function(){
                    load_favorites_page();
                });
                reset_backtracker();
                add_menu_backtracker();
                up();
                activated = !activated;
            });
            $("#btn-map").click(function(){
                if(!lock){
                    load_page("nav-map.html",true,function(){
                        load_map();
                        up();
                        activated = !activated;
                    });
                    reset_backtracker();
                    add_menu_backtracker();
                }
            });
            $("#btn-drone").click(function() {
                if(!lock){
                    load_page("cam-drone.html",true, function(){
                            clock = $('.clock').FlipClock(10, {
                            clockFace: 'MinuteCounter',
                            countdown: true,
                            callbacks: {
                                stop: function() {
                                    load_page("cam-drone-arrived.html",false);
                                }
                            }
                        }); 
                    });
                    up();
                    activated = !activated;
                     reset_backtracker();
                    add_menu_backtracker();
                }
                return false;
                
            });
            $("#btn-galeria").click(function() { 
                if(!lock){
                    load_page("cam-gallery.html",true, function(){
                        load_gallery();
                        up();
                        activated = !activated;
                    },true);
                    reset_backtracker();
                    add_menu_backtracker();
                }
                return false;
                
            });

            $("#btn-camprox").click(function() {
                if(!lock){
                    load_page("cam-photo.html",true,function(){
                        default_background();
                        reload_background(true);
                        up();
                        activated = !activated;
                        
                    });
                     reset_backtracker();
                    add_menu_backtracker();
                }
                return false;
                
            });
            $("#btn-camfix").click(function() {
                if(!lock){
                    load_page("cam-list.html",true,function(){
                        $(".horizontal-picture-slider").slick({
                            centerMode: true,
                            centerPadding: "10px",
                            infinite:false,
                            dots:true
                        });

                        $(".vertical-picture-slider").toggle();
                        $("#vertical-arrow").toggle();

                        $('.horizontal-picture-slider').on('swipe',function(event,slick,direction){
                            lock = true;
                        });
                        
                        $('.horizontal-picture-slider').on('afterChange',function(event,slick,currentSlide){
                            lock = false;
                        });
                        up();
                        activated = !activated;
                    });
                    
                }
                reset_backtracker();
                add_menu_backtracker();
                return false;
                
            });
        }
        
        $("#button-teleport").click(function(){
            if(navigation.destinations.length>0){
                var dest = get_location_by_id(navigation.destinations[0]);
                change_user_position(dest.x+5,dest.y+5);
                redraw_user();
            }
        });
        
        $("#button-main").click(function() {
            whatWasClicked = "main";
            if(!lock && !lockMenu){
                if(navigation.in_navigation){
                    load_page("nav-cancel.html", false,function(){
                        $('#button-home').prop('disabled', true);
                        $('#button-back').prop('disabled', true);
                        $('#button-lock').prop('disabled', true);
                        $('#button-main').prop('disabled', true);   
                    });
                }else{
                    activated = !activated;
                    if(activated){
                        down();
                    }
                    else{
                        up();
                    }
                }
            }
            return false;
        });

        $("#button-back").click(function() {
            whatWasClicked = "back";
            if(!lock){
                if(navigation.in_navigation){
                    load_page("nav-cancel.html", false,function(){
                        $('#button-home').prop('disabled', true);
                        $('#button-back').prop('disabled', true);
                        $('#button-lock').prop('disabled', true);
                        $('#button-main').prop('disabled', true);     
                    });
                }else{
                    back();
                }
            }
            return false;
        });
        
        $("#button-home").click(function() {
            whatWasClicked = "home";
            if(navigation.in_navigation){
                load_page("nav-cancel.html", false,function(){
                    $('#button-home').prop('disabled', true);
                    $('#button-back').prop('disabled', true);
                    $('#button-lock').prop('disabled', true);
                    $('#button-main').prop('disabled', true);   
                });
            }else{
                load_page("cam-main-menu.html",false,function(){
                    reset_backtracker();
                    add_menu_backtracker();
                    up();
                    activated = !activated;
                }); 
            }
        });
        
        $("#button-lock").click(function(){
            whatWasClicked = "lock";
            if(navigation.in_navigation){
                load_page("nav-cancel.html", false,function(){
                    $('#button-home').prop('disabled', true);
                    $('#button-back').prop('disabled', true);
                    $('#button-lock').prop('disabled', true);
                    $('#button-main').prop('disabled', true);   
                });
            }else{
                up();
                activated = !activated;
                load_page("unlock-screen.html",false,function(){
                    updateTime();
                    new Dragdealer('unlock', {
                        x: 1,
                        steps: 2,
                        loose: true,
                        callback: function(x, y) {
                            if (!x) {
                                this.disable();
                                $('#unlock').fadeOut();
                                setTimeout(function(){
                                    load_page("cam-main-menu.html",false);
                                },250);
                                $('#button-home').prop('disabled', false);
                                $('#button-back').prop('disabled', false);
                                $('#button-lock').prop('disabled', false);
                                $('#button-main').prop('disabled', false);
                            }
                        }
                    });
                
            });
            backtracker = [];
            $('#button-home').prop('disabled', true);
            $('#button-back').prop('disabled', true);
            $('#button-lock').prop('disabled', true);
            $('#button-main').prop('disabled', true);
            }
        });
        
        $(document).ready(function(){
            startTime();
            $(".screen").width(getPPI()*1.28*2.35);
            $(".screen").height(getPPI()*1.28*2.35);
            $(".screen-fit").width(getPPI()*1.28*2.35);
            $(".screen-fit").height(getPPI()*1.28*2.36);
            $(".menu-fit").width(getPPI()*1.28*2.35);
            $(".menu-fit").height(getPPI()*1.28*2.36*0.87)
            currentBackground ={
                pic: "pic1c.jpg",
                zoom: 0
            };
            currentPage={
                page: "cam-main-menu.html"
            };
            backtracker.push(currentPage);
            load_page("unlock-screen.html",false,function(){
                updateTime();
                unlock_drag = new Dragdealer('unlock', {
                    x: 1,
                    steps: 2,
                    loose: true,
                    callback: function(x, y) {
                        if (!x) {
                            this.disable();
                            $('#unlock').fadeOut();
                            setTimeout(function(){
                                load_page("cam-main-menu.html",false);
                            },250);
                        }
                    }
                });
            });
            
            //down();
            //activated = !activated;
            
            $("#main-container").css("margin-top",offset*0.87*(-1));

            $('.slick-menu-text').slick({
                slidesToShow: 1,
                dots:true
            });
            $('.slick-dots').css("padding-left","0px");
            $('.slick-menu').slick({
                slidesToShow: 1,
                slidesToScroll:1
            });
            $('.slick-menu').on('swipe',function(event,slick,direction){
                lock = true;
                if(direction == "right"){
                    $(".slick-menu-text").slick("slickPrev");
                }else{
                    $(".slick-menu-text").slick("slickNext");
                }
            });
            $('.slick-menu').on('afterChange',function(event,slick,currentSlide){
                lock = false;
            });
            $('.slick-menu-text').on('swipe',function(event,slick,direction){
                if(direction == "right"){
                    $(".slick-menu").slick("slickPrev");
                }else{
                    $(".slick-menu").slick("slickNext");
                }
            });
            bind_menu_buttons();

            $("#form-x").val(user.x);
            $("#form-y").val(user.y);
            $("#form-x").change(function(){
                user.x = $("#form-x").val();
                redraw_user();
            });
            $("#form-y").change(function(){
                user.y = $("#form-y").val();
                redraw_user();
            });
            $("#button-lock").click();
        })

    </script>
</body>
</html>